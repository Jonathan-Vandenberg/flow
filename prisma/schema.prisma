generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DocStatus {
  PENDING
  COMPLETE
  FAILED
  EXPIRED
}

enum AreaOfExpertise {
  VISA
  CONSULTANCY
  MARKETING
}

enum SubStatus {
  PENDING
  SUBSCRIBED
  EXPIRED
}

enum DirectoryStatus {
  IN_PROGRESS
  COMPLETE
}

enum StudentStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum RequirementStatus {
  NOT_REQUIRED
  REQUIRED
  PROCESSING
  PASSED
  FAILED
}

enum RequirementType {
  COE_ENGLISH
  COE_EDUCATION
  VISA
}

enum Sector {
  VOCATIONAL
  HIGH_EDUCATION
  HIGH_SCHOOL
}

enum Role {
  NORMAL
  ADMIN
  MANAGER
  AGENT
}

model Country {
  id            String         @id @default(uuid())
  name          String         @unique
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now())
  users         User[]
  organisations Organisation[]
  agencies      Agency[]
  students      Student[]
  Requirement   Requirement[]
}

model User {
  id        String  @id @default(uuid())
  managerId String?

  email         String           @unique
  firstName     String
  lastName      String
  mobile        String?
  countryId     String?
  imageUrl      String?
  expertiseArea AreaOfExpertise?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @default(now())

  managedStudents         Student[]
  socialMedia             SocialMedia[]             @relation("SocialMediaToAgent")
  agenciesOnOrganisations AgenciesOnOrganisations[]
  organisations           UsersOnOrganisations[]
  agencies                UsersOnAgencies[]
  country                 Country?                  @relation(fields: [countryId], references: [id])
}

model UsersOnOrganisations {
  userId         String
  organisationId String
  role           Role
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now())

  user         User         @relation(fields: [userId], references: [id])
  organisation Organisation @relation(fields: [organisationId], references: [id])

  @@id([userId, organisationId])
}

model Organisation {
  id        String    @id @default(uuid())
  name      String    @unique
  countryId String?
  subStatus SubStatus @default(PENDING)
  imageUrl  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())

  agencies                Agency[]
  students                Student[]
  courses                 Course[]
  requirements            Requirement[]
  agenciesOnOrganisations AgenciesOnOrganisations[]
  usersOnOrganisations    UsersOnOrganisations[]
  locations               OrganisationLocation[]
  country                 Country?                  @relation(fields: [countryId], references: [id])
}

model Agency {
  id                   String  @id @default(uuid())
  name                 String
  sector               Sector?
  countryId            String?
  district             String?
  market               String?
  commissionPercentage Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  organisations           Organisation[]
  contacts                Contact[]
  students                Student[]
  agenciesOnOrganisations AgenciesOnOrganisations[]
  users                   UsersOnAgencies[]
  country                 Country?                  @relation(fields: [countryId], references: [id])
}

model UsersOnAgencies {
  userId    String
  agencyId  String
  role      Role
  email     String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id])
  agency Agency @relation(fields: [agencyId], references: [id])

  @@id([userId, agencyId])
}

model AgenciesOnOrganisations {
  agencyId       String
  organisationId String
  managerId      String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now())

  organisation Organisation @relation(fields: [organisationId], references: [id])
  agency       Agency       @relation(fields: [agencyId], references: [id])
  user         User         @relation(fields: [managerId], references: [id])

  @@id([agencyId, organisationId])
}

model Requirement {
  id             String            @id @default(uuid())
  organisationId String
  courseId       String?
  studentId      String?
  details        String
  countryId      String?
  status         RequirementStatus
  type           RequirementType
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())

  student       Student?       @relation(fields: [studentId], references: [id])
  organisation  Organisation   @relation(fields: [organisationId], references: [id])
  directory     Directory[]
  exampleImages ExampleImage[]
  course        Course?        @relation(fields: [courseId], references: [id])
  country       Country?       @relation(fields: [countryId], references: [id])
}

model ExampleImage {
  id            String @id @default(uuid())
  requirementId String

  url         String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @default(now())
  requirement Requirement @relation(fields: [requirementId], references: [id])
}

model OrganisationLocation {
  id             String   @id @default(uuid())
  organisationId String
  location       String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now())

  organisation Organisation @relation(fields: [organisationId], references: [id])
  courses      Course[]
}

model Task {
  id        String @id @default(uuid())
  managerId String

  name        String
  description String
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
  tags        String[]

  documents Document[] @relation("documentToTask")
}

model Contact {
  id       String @id @default(uuid())
  agencyId String

  name      String
  title     String
  email     String
  mobile    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  agency Agency @relation(fields: [agencyId], references: [id])
}

model Course {
  id             String @id @default(uuid())
  organisationId String
  locationId     String

  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  organisation Organisation         @relation(fields: [organisationId], references: [id])
  location     OrganisationLocation @relation(fields: [locationId], references: [id])
  requirements Requirement[]
  students     Student[]
}

model Student {
  id             String  @id @default(uuid())
  organisationId String
  courseId       String
  agencyId       String
  agentId        String
  countryId      String?

  name               String?
  age                Int?
  guardianMobile     String?
  guardianEmail      String?
  expAttendDate      DateTime?
  gapYear            Boolean?
  gapYearExplanation String?
  previouslyRejected Boolean?
  status             StudentStatus @default(PENDING)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @default(now())

  agent        User          @relation(fields: [agentId], references: [id])
  course       Course        @relation(fields: [courseId], references: [id])
  agency       Agency        @relation(fields: [agencyId], references: [id])
  requirements Requirement[]
  directories  Directory[]   @relation("StudentDocsToStudent")
  organisation Organisation  @relation(fields: [organisationId], references: [id])
  country      Country?      @relation(fields: [countryId], references: [id])
}

model Document {
  id          String  @id @default(uuid())
  directoryId String
  taskId      String?

  url         String?
  name        String
  description String
  status      DocStatus @default(PENDING)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now())

  directory Directory @relation(fields: [directoryId], references: [id])
  task      Task?     @relation("documentToTask", fields: [taskId], references: [id])
}

model Directory {
  id            String @id @default(uuid())
  studentId     String
  requirementId String

  status    DirectoryStatus @default(IN_PROGRESS)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @default(now())

  documents   Document[]
  requirement Requirement @relation(fields: [requirementId], references: [id])
  student     Student     @relation("StudentDocsToStudent", fields: [studentId], references: [id])
}

model SocialMedia {
  id             String  @id @default(uuid())
  userId         String
  agentProfileId String?

  platform  String
  username  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  user User @relation("SocialMediaToAgent", fields: [userId], references: [id])
}
